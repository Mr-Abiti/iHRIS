"use strict";(self["webpackChunkiHRIS_v5"]=self["webpackChunkiHRIS_v5"]||[]).push([[926],{2540:function(t,e,i){i.d(e,{Z:function(){return n}});var s=i(6669),r=i(7678),n=(0,r.Z)(s.Z).extend({name:"v-subheader",props:{inset:Boolean},render(t){return t("div",{staticClass:"v-subheader",class:{"v-subheader--inset":this.inset,...this.themeClasses},attrs:this.$attrs,on:this.$listeners},this.$slots.default)}})},2405:function(t,e,i){i.r(e),i.d(e,{default:function(){return u}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"d-none"},[i("v-text-field",{attrs:{readonly:"","hide-details":"",dense:"",disabled:""},model:{value:t.hiddenValue,callback:function(e){t.hiddenValue=e},expression:"hiddenValue"}})],1)},r=[],n={name:"ihris-hidden",props:["label","path","hiddenType","hiddenValue"],data:function(){return{qField:"value"+this.hiddenType,value:this.hiddenValue}}},a=n,o=i(3736),l=i(3453),c=i.n(l),h=i(7808),d=(0,o.Z)(a,s,r,!1,null,null,null),u=d.exports;c()(d,{VTextField:h.Z})},4960:function(t,e,i){i.r(e),i.d(e,{default:function(){return v}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-card",{staticClass:"mx-auto",attrs:{"max-width":"700",outlined:""}},[i("v-card-title",{staticClass:"primary white--text font-weight-bold"},[t._v(t._s(t.$t("App.ihris-questionnaire-group."+t.label)))]),i("v-divider"),t._l(t.errors,(function(e,s){return i("v-card-text",{key:s,staticClass:"error white--text font-weight-bold"},[t._v(t._s(e))])})),i("v-card-text",{staticClass:"my-3"},[t._t("default")],2)],2)},r=[],n={name:"ihris-questionnaire-group",props:["label","path","constraints"],data:function(){return{isQuestionnaireGroup:!0,errors:[]}}},a=n,o=i(3736),l=i(3453),c=i.n(l),h=i(4145),d=i(4886),u=i(9223),p=(0,o.Z)(a,s,r,!1,null,null,null),v=p.exports;c()(p,{VCard:h.Z,VCardText:d.ZB,VCardTitle:d.EB,VDivider:u.Z})},6621:function(t,e,i){i.r(e),i.d(e,{default:function(){return p}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ihris-section pb-4",attrs:{id:"section-"+t.id}},[i("v-card",{staticClass:"mx-auto",attrs:{"max-width":"700",outlined:""}},[i("v-card-title",{staticClass:" justify-center darken-1 primary white--text text-uppercase font-weight-bold"},[t._v(t._s(t.$t("App.ihris-questionnaire-section."+t.label)))]),t._l(t.errors,(function(e,s){return i("v-card-text",{key:s,staticClass:"error white--text font-weight-bold"},[t._v(t._s(e))])})),i("v-card-text",{staticClass:"my-3"},[t._t("default")],2)],2)],1)},r=[],n={name:"ihris-questionnaire-section",props:["id","label","description","path","constraints"],data:function(){return{isQuestionnaireGroup:!0,errors:[]}}},a=n,o=i(3736),l=i(3453),c=i.n(l),h=i(4145),d=i(4886),u=(0,o.Z)(a,s,r,!1,null,null,null),p=u.exports;c()(u,{VCard:h.Z,VCardText:d.ZB,VCardTitle:d.EB})},4399:function(t,e,i){i.r(e),i.d(e,{default:function(){return Z}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",{staticClass:"my-3"},[i("ihris-practitioner-intro",{attrs:{isQuestionnaire:!0,slotProps:t.source}}),i("v-form",{ref:"form",attrs:{id:"app"},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[t._t("default"),i("v-overlay",{attrs:{value:t.overlay}},[i("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}}),i("v-btn",{attrs:{icon:""},on:{click:function(e){t.overlay=!1}}},[i("v-icon",[t._v("mdi-close")])],1)],1),i("v-navigation-drawer",{staticClass:"primary darken-1 white--text",staticStyle:{"z-index":"3"},attrs:{app:"",clipped:"",permanent:"",right:""}},[i("v-list",{staticClass:"white--text"},[i("v-list-item",[i("v-btn",{staticClass:"secondary",attrs:{dark:""},on:{click:function(e){return t.$router.go(-1)}}},[i("v-icon",{attrs:{light:""}},[t._v("mdi-close-circle-outline")]),i("span",[t._v(t._s(t.$t("App.ihris-questionnaire.Cancel")))])],1),i("v-spacer"),t.valid?i("v-btn",{staticClass:"success darken-1",attrs:{disabled:!t.valid,dark:""},on:{click:function(e){return t.processFHIR()}}},[i("v-icon",{attrs:{light:""}},[t._v("mdi-content-save")]),i("span",[t._v(t._s(t.$t("App.ihris-questionnaire.Save")))])],1):i("v-btn",{staticClass:"green",attrs:{dark:""},on:{click:function(e){return t.$refs.form.validate()}}},[i("v-icon",{attrs:{light:""}},[t._v("mdi-content-save")]),i("span",[t._v(t._s(t.$t("App.ihris-questionnaire.Save")))])],1)],1),"/questionnaire/ihris-practitioner/practitioner"===t.$router.history.current.path?i("v-list-item",[i("v-btn",{staticClass:"primary",attrs:{dark:""},on:{click:function(e){return t.$router.push("/bulk-registration")}}},[i("v-icon",{attrs:{light:""}},[t._v("mdi-attachment")]),i("span",[t._v(t._s(t.$t("App.ihris-questionnaire.uploadCSV")))])],1)],1):t._e(),"/questionnaire/ihris-practitioner/practitioner"===t.$router.history.current.path?i("v-list-item",[i("v-btn",{staticClass:"primary",attrs:{dark:""},on:{click:t.getCsvTemplate}},[i("v-icon",{attrs:{light:""}},[t._v("mdi-download")]),i("span",[t._v(t._s(t.$t("App.ihris-questionnaire.getCSVTemplate")))])],1)],1):t._e(),i("v-divider",{attrs:{color:"white"}}),t.sectionMenu?i("v-subheader",{staticClass:"white--text"},[i("h2",[t._v(t._s(t.$t("App.ihris-questionnaire.Section")))])]):t._e(),t._l(t.sectionMenu,(function(e){return i("v-list-item",{key:e.id,class:"#section-"+e.id===t.path?"highlighted":"",attrs:{href:"#section-"+e.id}},[i("v-list-item-content",{staticClass:"white--text"},[i("v-list-item-title",{staticClass:"text-uppercase"},[i("h4",[t._v(t._s(t.$t("App.ihris-questionnaire-section."+e.title)))])]),i("v-list-item-subtitle",{staticClass:"white--text"},[t._v(t._s(t.$t("App.ihris-questionnaire-section."+e.desc))+" ")])],1)],1)}))],2)],1)],2)],1)},r=[],n=i(9669),a=i.n(n);const o=i(7673);var l={name:"ihris-questionnaire",components:{"ihris-practitioner-intro":()=>Promise.all([i.e(344),i.e(747),i.e(669),i.e(513),i.e(657)]).then(i.bind(i,3024))},props:["id","url","title","description","purpose","section-menu","view-page","edit","constraints"],data:function(){return{fhir:{},loading:!1,overlay:!1,isEdit:!1,valid:!0,advancedValid:!0,position:"",source:{path:"",data:{}},path:""}},watch:{$route:function(){this.path=this.$route.hash}},created:function(){let t=this.$route.query,e=t.practitioner;e&&(fetch(`/fhir/PractitionerRole?_practitioner=${this.fhirId}`).then((t=>{t.json().then((t=>{let e=t.entry?t.entry[0].resource.code[0].coding[0].display:"";this.position=e||"",this.position=e||""})).catch((t=>{console.log(this.field,this.fhirId,t)}))})).catch((t=>{console.log(this.field,this.fhirId,t)})),fetch("/fhir/Practitioner/"+e).then((t=>{t.json().then((t=>{this.source={source:{data:t,path:"Practitioner"}}})).catch((t=>{console.log(t)}))})).catch((t=>{console.log(t)})))},mounted(){this.isQuestionnaire?window.removeEventListener("scroll",this.handleScroll):window.addEventListener("scroll",this.handleScroll)},beforeDestroy(){window.removeEventListener("scroll",this.handleScroll)},methods:{logout(){this.loading=!0,fetch("/auth/logout").then((()=>{this.loading=!1,this.$store.commit("logout"),this.$store.commit("setMessage",{type:"success",text:"You change your password success fully."}),this.$router.push({path:"/"})}))},handleScroll(){this.hasScrolled=window.top.scrollY>=100,this.sectionMenu.map((t=>{let e=document.getElementById(`section-${t.id}`),i=e.offsetTop;pageYOffset>=i&&(this.path=`#section-${t.id}`)}))},getCsvTemplate(){a()({url:"/fhir/csvTemplate",method:"GET",responseType:"blob"}).then((t=>{let e=new Blob([t.data],{type:"application/vnd.ms-excel"}),i=document.createElement("a");i.href=window.URL.createObjectURL(e),i.download="User_bulk_registration_template.xlsx",i.click()}))},processFHIR:async function(){if(this.$refs.form.validate(),!this.valid)return;this.advancedValid=!0,this.overlay=!0,this.loading=!0;const t=async(e,i,s)=>{s||(s={});for(let n of i){let i=e,a={};if(n.isArray);else if(n.isQuestionnaireGroup){let t={linkId:n.path,text:n.label,item:[]};i.push(t),i=t.item}else if(n.qField){let t;s.hasOwnProperty(n.path)?t=s[n.path]:(t={linkId:n.path,answer:[]},s[n.path]=t,i.push(t));let e={};if(e[n.qField]=n.value,t.answer.push(e),n.constraints){n.errors=[];try{this.advancedValid=this.advancedValid&&await this.$fhirutils.checkConstraints(n.constraints,this.constraints,n.value,n.errors)}catch(r){this.advancedValid=!1,n.errors.push("An unknown error occurred."),console.log(r)}}}if(n.$children)try{await t(i,n.$children,a)}catch(r){this.advancedValid=!1,console.log(r)}if(n.isQuestionnaireGroup&&n.constraints){n.errors=[];try{this.advancedValid=this.advancedValid&&await this.$fhirutils.checkConstraints(n.constraints,this.constraints,i,n.errors)}catch(r){this.advancedValid=!1,n.errors.push("An unknown error occurred."),console.log(r)}}}};this.fhir={resourceType:"QuestionnaireResponse",questionnaire:this.url,status:"completed",item:[]};try{await t(this.fhir.item,this.$children)}catch(e){this.advancedValid=!1,console.log(e)}if(!this.advancedValid)return this.overlay=!1,this.loading=!1,void this.$store.commit("setMessage",{type:"error",text:"There were errors on the form."});this.fhir.item.find((t=>"Practitioner:communication"===t.linkId))&&this.fhir.item.find((t=>"Practitioner:communication"===t.linkId)).item.map(((t,e)=>{t.linkId=`Practitioner:communication[${e}]`,t.item[0].linkId=`Practitioner.communication[${e}]`})),console.log("SAVE",this.fhir),fetch("/fhir/QuestionnaireResponse?"+o.stringify(this.$route.query),{method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify(this.fhir)}).then((t=>{201===t.status?(t.json().then((t=>{let e;if(this.overlay=!1,this.loading=!1,this.viewPage){if(t.meta.tag){let i=t.meta.tag.find((t=>"http://ihris.org/fhir/tags/resource"===t.system));i&&i.code&&(e=i.code)}if(!e&&t.subject&&t.subject.reference&&(e=t.subject.reference),e){let i=e.split("/");i=i[1]?i[1]:e,"http://ihris.org/fhir/Questionnaire/ihris-change-password"===t.questionnaire&&this.logout(),this.$router.push({name:"resource_view",params:{page:this.viewPage,id:i}})}}e||this.$router.push({name:"home"})})),this.$store.commit("setMessage",{type:"success",text:"Added successfully."})):(this.overlay=!1,this.loading=!1,t.json().then((t=>{let i;if("OperationOutcome"==t.resourceType)try{i=Array.from(new Set(t.issue.map((t=>t.diagnostics)))).join(", ")}catch(e){console.log("Unable to retrieve errors from ",t)}else i="Unknown";this.$store.commit("setMessage",{type:"error",text:"An error occurred trying to save this record: "+i})})).catch((t=>{this.$store.commit("setMessage",{type:"error",text:"An unknown error occurred trying to save this record."}),console.log("Error on retrieving error status",t)})))})).catch((t=>{console.log(t),this.overlay=!1,this.loading=!1,this.$store.commit("setMessage",{type:"error",text:"Failed to update data."})}))}}},c=l,h=i(3736),d=i(3453),u=i.n(d),p=i(4562),v=i(9256),f=i(9223),m=i(5125),g=i(4324),y=i(5808),_=i(4525),w=i(9478),$=i(9709),b=i(2933),C=i(3305),V=i(3687),x=i(2540),k=(0,h.Z)(c,s,r,!1,null,null,null),Z=k.exports;u()(k,{VBtn:p.Z,VContainer:v.Z,VDivider:f.Z,VForm:m.Z,VIcon:g.Z,VList:y.Z,VListItem:_.Z,VListItemContent:w.km,VListItemSubtitle:w.oZ,VListItemTitle:w.V9,VNavigationDrawer:$.Z,VOverlay:b.Z,VProgressCircular:C.Z,VSpacer:V.Z,VSubheader:x.Z})}}]);
//# sourceMappingURL=fhir-questionnaire.fb93e883.js.map