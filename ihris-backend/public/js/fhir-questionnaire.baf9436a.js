(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["fhir-questionnaire"],{4983:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"ihris-section",attrs:{id:"section-"+t.id}},[r("v-card",{staticClass:"mx-auto",attrs:{"max-width":"700",outlined:""}},[r("v-card-title",{staticClass:"primary darken-1 white--text text-uppercase font-weight-bold"},[t._v(t._s(t.$t("App.ihris-questionnaire-section."+t.label)))]),t._l(t.errors,(function(e,i){return r("v-card-text",{key:i,staticClass:"error white--text font-weight-bold"},[t._v(t._s(e))])})),r("v-card-text",{staticClass:"my-3"},[t._t("default")],2)],2)],1)},n=[],a={name:"ihris-questionnaire-section",props:["id","label","description","path","constraints"],data:function(){return{isQuestionnaireGroup:!0,errors:[]}}},s=a,o=r("2877"),c=r("6544"),l=r.n(c),u=r("b0af"),d=r("99d9"),h=Object(o["a"])(s,i,n,!1,null,null,null);e["default"]=h.exports;l()(h,{VCard:u["a"],VCardText:d["c"],VCardTitle:d["d"]})},5105:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"d-none"},[r("v-text-field",{attrs:{readonly:"","hide-details":"",dense:"",disabled:""},model:{value:t.hiddenValue,callback:function(e){t.hiddenValue=e},expression:"hiddenValue"}})],1)},n=[],a={name:"ihris-hidden",props:["label","path","hiddenType","hiddenValue"],data:function(){return{qField:"value"+this.hiddenType,value:this.hiddenValue}}},s=a,o=r("2877"),c=r("6544"),l=r.n(c),u=r("8654"),d=Object(o["a"])(s,i,n,!1,null,null,null);e["default"]=d.exports;l()(d,{VTextField:u["a"]})},8238:function(t,e,r){},c5a6:function(t,e,r){"use strict";var i=r("8238"),n=r.n(i);n.a},f43a:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-card",{staticClass:"mx-auto",attrs:{"max-width":"700",outlined:""}},[r("v-card-title",{staticClass:"primary white--text  font-weight-bold"},[t._v(t._s(t.$t("App.ihris-questionnaire-group."+t.label)))]),t._l(t.errors,(function(e,i){return r("v-card-text",{key:i,staticClass:"error white--text font-weight-bold"},[t._v(t._s(e))])})),r("v-card-text",{staticClass:"my-3"},[t._t("default")],2)],2)},n=[],a={name:"ihris-questionnaire-group",props:["label","path","constraints"],data:function(){return{isQuestionnaireGroup:!0,errors:[]}}},s=a,o=r("2877"),c=r("6544"),l=r.n(c),u=r("b0af"),d=r("99d9"),h=Object(o["a"])(s,i,n,!1,null,null,null);e["default"]=h.exports;l()(h,{VCard:u["a"],VCardText:d["c"],VCardTitle:d["d"]})},f977:function(t,e,r){"use strict";r.r(e);var i=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("v-container",{staticClass:"my-3"},[r("ihris-practitioner-intro",{attrs:{isQuestionnaire:!0,slotProps:t.source}}),r("v-form",{ref:"form",attrs:{id:"app"},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[t._t("default"),r("v-overlay",{attrs:{value:t.overlay}},[r("v-progress-circular",{attrs:{color:"primary",indeterminate:"",size:"50"}}),r("v-btn",{attrs:{icon:""},on:{click:function(e){t.overlay=!1}}},[r("v-icon",[t._v("mdi-close")])],1)],1),r("v-navigation-drawer",{staticClass:"primary darken-1 white--text",staticStyle:{"z-index":"3"},attrs:{app:"",clipped:"",permanent:"",right:""}},[r("v-list",{staticClass:"white--text"},[r("v-list-item",[r("v-btn",{staticClass:"secondary",attrs:{dark:""},on:{click:function(e){return t.$router.go(-1)}}},[r("v-icon",{attrs:{light:""}},[t._v("mdi-pencil-off")]),r("span",[t._v(t._s(t.$t("App.ihris-questionnaire.Cancel")))])],1),r("v-spacer"),t.valid?r("v-btn",{staticClass:"success darken-1",attrs:{disabled:!t.valid,dark:""},on:{click:function(e){return t.processFHIR()}}},[r("v-icon",{attrs:{light:""}},[t._v("mdi-content-save")]),r("span",[t._v(t._s(t.$t("App.ihris-questionnaire.Save")))])],1):r("v-btn",{staticClass:"warning",attrs:{dark:""},on:{click:function(e){return t.$refs.form.validate()}}},[r("v-icon",{attrs:{light:""}},[t._v("mdi-content-save")]),r("span",[t._v(t._s(t.$t("App.ihris-questionnaire.Save")))])],1)],1),"/questionnaire/ihris-practitioner/practitioner"===t.$router.history.current.path?r("v-list-item",[r("v-btn",{staticClass:"primary",attrs:{dark:""},on:{click:function(e){return t.$router.push("/bulk-registration")}}},[r("v-icon",{attrs:{light:""}},[t._v("mdi-attachment")]),r("span",[t._v(t._s(t.$t("App.ihris-questionnaire.uploadCSV")))])],1)],1):t._e(),"/questionnaire/ihris-practitioner/practitioner"===t.$router.history.current.path?r("v-list-item",[r("v-btn",{staticClass:"primary",attrs:{dark:""},on:{click:t.getCsvTemplate}},[r("v-icon",{attrs:{light:""}},[t._v("mdi-download")]),r("span",[t._v(t._s(t.$t("App.ihris-questionnaire.getCSVTemplate")))])],1)],1):t._e(),r("v-divider",{attrs:{color:"white"}}),t.sectionMenu?r("v-subheader",{staticClass:"white--text"},[r("h2",[t._v(t._s(t.$t("App.ihris-questionnaire.Section")))])]):t._e(),t._l(t.sectionMenu,(function(e){return r("v-list-item",{key:e.id,class:"#section-"+e.id===t.path?"highlighted":"",attrs:{href:"#section-"+e.id}},[r("v-list-item-content",{staticClass:"white--text"},[r("v-list-item-title",{staticClass:"text-uppercase"},[r("h4",[t._v(t._s(t.$t("App.ihris-questionnaire-section."+e.title)))])]),r("v-list-item-subtitle",{staticClass:"white--text"},[t._v(t._s(t.$t("App.ihris-questionnaire-section."+e.desc))+" ")])],1)],1)}))],2)],1)],2)],1)},n=[],a=(r("7db0"),r("a630"),r("a15b"),r("d81d"),r("d3b7"),r("ac1f"),r("6062"),r("3ca3"),r("1276"),r("ddb0"),r("2b3d"),r("b85c")),s=(r("96cf"),r("1da1")),o=r("bc3a"),c=r.n(o),l=r("b383"),u={name:"ihris-questionnaire",components:{"ihris-practitioner-intro":function(){return Promise.all([r.e("fhir-primary~fhir-search~fhir-secondary~mhero~questionnaire"),r.e("fhir-primary~fhir-search~mhero~questionnaire"),r.e("fhir-primary~fhir-search~questionnaire"),r.e("fhir-main~fhir-primary"),r.e("fhir-primary")]).then(r.bind(null,"6dbd"))}},props:["id","url","title","description","purpose","section-menu","view-page","edit","constraints"],data:function(){return{fhir:{},loading:!1,overlay:!1,isEdit:!1,valid:!0,advancedValid:!0,position:"",source:{path:"",data:{}},path:""}},watch:{$route:function(){this.path=this.$route.hash}},created:function(){var t=this,e=this.$route.query,r=e.practitioner;r&&(fetch("/fhir/PractitionerRole?_practitioner=".concat(this.fhirId)).then((function(e){e.json().then((function(e){var r=e.entry?e.entry[0].resource.code[0].coding[0].display:"";t.position=r||"",t.position=r||""})).catch((function(e){console.log(t.field,t.fhirId,e)}))})).catch((function(e){console.log(t.field,t.fhirId,e)})),fetch("/fhir/Practitioner/"+r).then((function(e){e.json().then((function(e){t.source={source:{data:e,path:"Practitioner"}}})).catch((function(t){console.log(t)}))})).catch((function(t){console.log(t)})))},mounted:function(){this.isQuestionnaire?window.removeEventListener("scroll",this.handleScroll):window.addEventListener("scroll",this.handleScroll)},beforeDestroy:function(){window.removeEventListener("scroll",this.handleScroll)},methods:{logout:function(){var t=this;this.loading=!0,fetch("/auth/logout").then((function(){t.loading=!1,t.$store.commit("logout"),t.$store.commit("setMessage",{type:"success",text:"You change your password success fully."}),t.$router.push({path:"/"})}))},handleScroll:function(){var t=this;this.hasScrolled=window.top.scrollY>=100,this.sectionMenu.map((function(e){var r=document.getElementById("section-".concat(e.id)),i=r.offsetTop;pageYOffset>=i&&(t.path="#section-".concat(e.id))}))},getCsvTemplate:function(){c()({url:"/fhir/csvTemplate",method:"GET",responseType:"blob"}).then((function(t){var e=new Blob([t.data],{type:"application/vnd.ms-excel"}),r=document.createElement("a");r.href=window.URL.createObjectURL(e),r.download="User_bulk_registration_template.xlsx",r.click()}))},processFHIR:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){var e,r=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.$refs.form.validate(),this.valid){t.next=3;break}return t.abrupt("return");case 3:return this.advancedValid=!0,this.overlay=!0,this.loading=!0,e=function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(i,n,s){var o,c,l,u,d,h,p,f;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s||(s={}),o=Object(a["a"])(n),t.prev=2,o.s();case 4:if((c=o.n()).done){t.next=67;break}if(l=c.value,u=i,d={},!l.isArray){t.next=11;break}t.next=39;break;case 11:if(!l.isQuestionnaireGroup){t.next=17;break}h={linkId:l.path,text:l.label,item:[]},u.push(h),u=h.item,t.next=39;break;case 17:if(!l.qField){t.next=39;break}if(p=void 0,s.hasOwnProperty(l.path)?p=s[l.path]:(p={linkId:l.path,answer:[]},s[l.path]=p,u.push(p)),f={},f[l.qField]=l.value,p.answer.push(f),!l.constraints){t.next=39;break}if(l.errors=[],t.prev=25,t.t0=r.advancedValid,!t.t0){t.next=31;break}return t.next=30,r.$fhirutils.checkConstraints(l.constraints,r.constraints,l.value,l.errors);case 30:t.t0=t.sent;case 31:r.advancedValid=t.t0,t.next=39;break;case 34:t.prev=34,t.t1=t["catch"](25),r.advancedValid=!1,l.errors.push("An unknown error occurred."),console.log(t.t1);case 39:if(!l.$children){t.next=49;break}return t.prev=40,t.next=43,e(u,l.$children,d);case 43:t.next=49;break;case 45:t.prev=45,t.t2=t["catch"](40),r.advancedValid=!1,console.log(t.t2);case 49:if(!l.isQuestionnaireGroup||!l.constraints){t.next=65;break}if(l.errors=[],t.prev=51,t.t3=r.advancedValid,!t.t3){t.next=57;break}return t.next=56,r.$fhirutils.checkConstraints(l.constraints,r.constraints,u,l.errors);case 56:t.t3=t.sent;case 57:r.advancedValid=t.t3,t.next=65;break;case 60:t.prev=60,t.t4=t["catch"](51),r.advancedValid=!1,l.errors.push("An unknown error occurred."),console.log(t.t4);case 65:t.next=4;break;case 67:t.next=72;break;case 69:t.prev=69,t.t5=t["catch"](2),o.e(t.t5);case 72:return t.prev=72,o.f(),t.finish(72);case 75:case"end":return t.stop()}}),t,null,[[2,69,72,75],[25,34],[40,45],[51,60]])})));return function(e,r,i){return t.apply(this,arguments)}}(),this.fhir={resourceType:"QuestionnaireResponse",questionnaire:this.url,status:"completed",item:[]},t.prev=8,t.next=11,e(this.fhir.item,this.$children);case 11:t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](8),this.advancedValid=!1,console.log(t.t0);case 17:if(this.advancedValid){t.next=22;break}return this.overlay=!1,this.loading=!1,this.$store.commit("setMessage",{type:"error",text:"There were errors on the form."}),t.abrupt("return");case 22:this.fhir.item.find((function(t){return"Practitioner:communication"===t.linkId}))&&this.fhir.item.find((function(t){return"Practitioner:communication"===t.linkId})).item.map((function(t,e){t.linkId="Practitioner:communication[".concat(e,"]"),t.item[0].linkId="Practitioner.communication[".concat(e,"]")})),console.log("SAVE",this.fhir),fetch("/fhir/QuestionnaireResponse?"+l.stringify(this.$route.query),{method:"POST",headers:{"Content-Type":"application/fhir+json"},redirect:"manual",body:JSON.stringify(this.fhir)}).then((function(t){201===t.status?(t.json().then((function(t){var e;if(r.overlay=!1,r.loading=!1,r.viewPage){if(t.meta.tag){var i=t.meta.tag.find((function(t){return"http://ihris.org/fhir/tags/resource"===t.system}));i&&i.code&&(e=i.code)}if(!e&&t.subject&&t.subject.reference&&(e=t.subject.reference),e){var n=e.split("/");n=n[1]?n[1]:e,"http://ihris.org/fhir/Questionnaire/ihris-change-password"===t.questionnaire&&r.logout(),r.$router.push({name:"resource_view",params:{page:r.viewPage,id:n}})}}e||r.$router.push({name:"home"})})),r.$store.commit("setMessage",{type:"success",text:"Added successfully."})):(r.overlay=!1,r.loading=!1,t.json().then((function(t){var e;if("OperationOutcome"==t.resourceType)try{e=Array.from(new Set(t.issue.map((function(t){return t.diagnostics})))).join(", ")}catch(i){console.log("Unable to retrieve errors from ",t)}else e="Unknown";r.$store.commit("setMessage",{type:"error",text:"An error occurred trying to save this record: "+e})})).catch((function(t){r.$store.commit("setMessage",{type:"error",text:"An unknown error occurred trying to save this record."}),console.log("Error on retrieving error status",t)})))})).catch((function(t){console.log(t),r.overlay=!1,r.loading=!1,r.$store.commit("setMessage",{type:"error",text:"Failed to update data."})}));case 25:case"end":return t.stop()}}),t,this,[[8,13]])})));function e(){return t.apply(this,arguments)}return e}()}},d=u,h=(r("c5a6"),r("2877")),p=r("6544"),f=r.n(p),v=r("8336"),m=r("a523"),b=r("ce7e"),g=r("4bd4"),y=r("132d"),x=r("8860"),w=r("da13"),k=r("5d23"),_=r("f774"),V=r("a797"),C=r("490a"),$=r("2fa4"),q=r("e0c7"),T=Object(h["a"])(d,i,n,!1,null,null,null);e["default"]=T.exports;f()(T,{VBtn:v["a"],VContainer:m["a"],VDivider:b["a"],VForm:g["a"],VIcon:y["a"],VList:x["a"],VListItem:w["a"],VListItemContent:k["a"],VListItemSubtitle:k["b"],VListItemTitle:k["c"],VNavigationDrawer:_["a"],VOverlay:V["a"],VProgressCircular:C["a"],VSpacer:$["a"],VSubheader:q["a"]})}}]);
//# sourceMappingURL=fhir-questionnaire.baf9436a.js.map